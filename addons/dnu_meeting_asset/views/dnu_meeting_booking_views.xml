<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Calendar View -->
        <record id="view_dnu_meeting_booking_calendar" model="ir.ui.view">
            <field name="name">dnu.meeting.booking.calendar</field>
            <field name="model">dnu.meeting.booking</field>
            <field name="arch" type="xml">
                <calendar string="L·ªãch ƒë·∫∑t ph√≤ng" 
                          date_start="start_datetime" 
                          date_stop="end_datetime" 
                          color="room_id" 
                          mode="week"
                          quick_add="True"
                          event_open_popup="True"
                          form_view_id="%(view_dnu_meeting_booking_form)d">
                    <field name="subject"/>
                    <field name="room_id"/>
                    <field name="organizer_name"/>
                    <field name="nhan_vien_to_chuc_id" invisible="1"/>
                    <field name="organizer_id" invisible="1"/>
                    <field name="state" filters="1" invisible="1"/>
                </calendar>
            </field>
        </record>

        <!-- Tree View -->
        <record id="view_dnu_meeting_booking_tree" model="ir.ui.view">
            <field name="name">dnu.meeting.booking.tree</field>
            <field name="model">dnu.meeting.booking</field>
            <field name="arch" type="xml">
                <tree string="ƒê·∫∑t ph√≤ng" decoration-info="state=='confirmed'" decoration-success="state=='done'" decoration-muted="state=='cancelled'" decoration-danger="has_conflicts">
                    <field name="name"/>
                    <field name="subject"/>
                    <field name="room_id"/>
                    <field name="meeting_type" widget="badge" decoration-info="meeting_type=='online'" decoration-success="meeting_type=='offline'"/>
                    <field name="organizer_name" string="Ng∆∞·ªùi t·ªï ch·ª©c"/>
                    <field name="nhan_vien_to_chuc_id" optional="hide"/>
                    <field name="organizer_id" optional="hide"/>
                    <field name="start_datetime"/>
                    <field name="end_datetime"/>
                    <field name="duration" widget="float_time"/>
                    <field name="num_attendees"/>
                    <field name="zoom_meeting_id" optional="hide"/>
                    <field name="state" widget="badge" decoration-info="state=='confirmed'" decoration-warning="state=='in_progress'" decoration-success="state=='done'"/>
                    <button name="action_confirm" string="Duy·ªát" type="object" class="btn-primary" attrs="{'invisible': [('state', '!=', 'submitted')]}" icon="fa-check"/>
                    <button name="action_cancel" string="T·ª´ ch·ªëi" type="object" class="btn-danger" attrs="{'invisible': [('state', '!=', 'submitted')]}" icon="fa-times"/>
                    <field name="has_conflicts" invisible="1"/>
                </tree>
            </field>
        </record>

        <!-- Form View -->
        <record id="view_dnu_meeting_booking_form" model="ir.ui.view">
            <field name="name">dnu.meeting.booking.form</field>
            <field name="model">dnu.meeting.booking</field>
            <field name="arch" type="xml">
                <form string="ƒê·∫∑t ph√≤ng h·ªçp">
                    <header>
                        <button name="action_submit" string="G·ª≠i y√™u c·∫ßu" type="object" class="btn-primary" attrs="{'invisible': [('state', '!=', 'draft')]}"/>
                        <button name="action_confirm" string="X√°c nh·∫≠n" type="object" class="btn-primary" attrs="{'invisible': [('state', '!=', 'submitted')]}" groups="dnu_meeting_asset.group_facility_staff"/>
                        <button name="action_checkin" string="Check-in" type="object" class="btn-success" attrs="{'invisible': ['|', ('state', '!=', 'confirmed'), ('can_checkin', '=', False)]}"/>
                        <button name="action_checkout" string="Check-out" type="object" class="btn-warning" attrs="{'invisible': [('state', '!=', 'in_progress')]}"/>
                        <button name="action_cancel" string="H·ªßy" type="object" attrs="{'invisible': [('state', 'in', ['done', 'cancelled'])]}" confirm="B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën h·ªßy l·ªãch ƒë·∫∑t ph√≤ng n√†y?"/>
                        <button name="action_suggest_alternatives" string="G·ª£i √Ω ph√≤ng kh√°c" type="object" attrs="{'invisible': [('has_conflicts', '=', False)]}" class="btn-info"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,submitted,confirmed,in_progress,done"/>
                    </header>
                    <sheet>
                        <field name="can_checkin" invisible="1"/>
                        <field name="has_conflicts" invisible="1"/>
                        <field name="is_past" invisible="1"/>
                        <field name="zoom_meeting_id" invisible="1"/>
                        <field name="google_calendar_event_id" invisible="1"/>
                        
                        <!-- Stat Buttons -->
                        <div class="oe_button_box" name="button_box">
                            <button class="oe_stat_button" type="object" name="action_view_room_bookings" icon="fa-calendar">
                                <div class="o_field_widget o_stat_info">
                                    <span class="o_stat_text">L·ªãch</span>
                                    <span class="o_stat_text">Ph√≤ng h·ªçp</span>
                                </div>
                            </button>
                            <button class="oe_stat_button" type="object" name="action_open_zoom_meeting" icon="fa-video-camera"
                                    attrs="{'invisible': [('zoom_meeting_id', '=', False)]}">
                                <div class="o_field_widget o_stat_info">
                                    <span class="o_stat_text">Zoom</span>
                                    <span class="o_stat_text">Meeting</span>
                                </div>
                            </button>
                            <button class="oe_stat_button" type="object" name="action_open_google_calendar" icon="fa-google"
                                    attrs="{'invisible': [('google_calendar_event_id', '=', False)]}">
                                <div class="o_field_widget o_stat_info">
                                    <span class="o_stat_text">Google</span>
                                    <span class="o_stat_text">Calendar</span>
                                </div>
                            </button>
                            <button class="oe_stat_button" icon="fa-users">
                                <field name="num_attendees" widget="statinfo" string="Ng∆∞·ªùi tham d·ª±"/>
                            </button>
                            <button class="oe_stat_button" type="object" name="action_view_van_ban_den" icon="fa-file-text-o">
                                <field name="van_ban_den_count" widget="statinfo" string="VƒÉn b·∫£n ƒë·∫øn"/>
                            </button>
                        </div>
                        
                        <div class="alert alert-danger" role="alert" attrs="{'invisible': [('has_conflicts', '=', False)]}">
                            <strong><i class="fa fa-exclamation-triangle"/> C·∫£nh b√°o:</strong> C√≥ xung ƒë·ªôt v·ªõi booking kh√°c!
                            <field name="conflict_ids" invisible="1"/>
                        </div>
                        <div class="alert alert-warning" role="alert" attrs="{'invisible': [('state', '!=', 'cancelled')]}">
                            <strong><i class="fa fa-ban"/> ƒê√£ h·ªßy:</strong> L·ªãch ƒë·∫∑t ph√≤ng n√†y ƒë√£ b·ªã h·ªßy.
                        </div>
                        <div class="oe_title">
                            <h1>
                                <field name="name" readonly="1"/>
                            </h1>
                            <h2>
                                <field name="subject" placeholder="Ch·ªß ƒë·ªÅ cu·ªôc h·ªçp..."/>
                            </h2>
                        </div>
                        
                        <style>
                            .o_booking_modern_form .o_group {
                                margin-bottom: 20px;
                            }
                            .o_booking_modern_form .o_group .o_group_col {
                                background: #f8f9fa;
                                padding: 15px;
                                border-radius: 8px;
                                border: 1px solid #e9ecef;
                            }
                            .o_booking_modern_form h2 {
                                color: #2980B9;
                                font-weight: 600;
                            }
                            .o_booking_modern_form .alert-info {
                                background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%);
                                border-left: 4px solid #2196F3;
                                color: #1565C0;
                            }
                            .o_booking_modern_form .o_field_many2manytags .badge {
                                background: linear-gradient(135deg, #E67E22 0%, #D35400 100%);
                                color: white;
                                padding: 6px 12px;
                                border-radius: 20px;
                                font-weight: 500;
                            }
                        </style>
                        
                        <group class="o_booking_modern_form">
                            <group string="Th√¥ng tin ph√≤ng h·ªçp">
                                <field name="num_attendees"/>
                                <group string="Ti·ªán nghi" col="3">
                                    <field name="need_projector"/>
                                    <field name="need_video_conference"/>
                                    <field name="need_whiteboard"/>
                                </group>
                                <field name="suggested_room_ids" invisible="1"/>
                                <div class="alert alert-success" attrs="{'invisible': [('suggested_room_ids', '=', [])]}" style="padding: 8px 12px; margin: 8px 0; font-size: 12px;">
                                    <i class="fa fa-check-circle"/> <b>G·ª£i √Ω:</b> H·ªá th·ªëng ƒë√£ l·ªçc c√°c ph√≤ng ph√π h·ª£p theo s·ªë ng∆∞·ªùi v√† ti·ªán nghi.
                                </div>
                                <field name="room_id" options="{'no_create': True}"/>
                                <field name="meeting_type" widget="radio"/>
                                <field name="start_datetime"/>
                                <field name="end_datetime"/>
                                <field name="duration" widget="float_time"/>
                            </group>
                            <group string="Ng∆∞·ªùi t·ªï ch·ª©c">
                                <field name="nhan_vien_to_chuc_id" string="Ng∆∞·ªùi t·ªï ch·ª©c" options="{'no_quick_create': True}" placeholder="Ch·ªçn ng∆∞·ªùi t·ªï ch·ª©c"/>
                            </group>
                        </group>
                        <field name="attendee_ids" invisible="1"/>
                        <group class="o_booking_modern_form">
                            <group string="B·ªï sung trang thi·∫øt b·ªã">
                                <div class="alert alert-info mb-2" role="alert" style="padding: 8px 12px; font-size: 12px;">
                                    <i class="fa fa-info-circle"/> <b>L∆∞u √Ω:</b> Ch·ªâ hi·ªÉn th·ªã thi·∫øt b·ªã s·∫µn s√†ng v√† ch∆∞a b·ªã m∆∞·ª£n trong kho·∫£ng th·ªùi gian ƒë·∫∑t ph√≤ng.
                                </div>
                                <field name="required_equipment_ids" 
                                       widget="many2many_tags" 
                                       nolabel="1"
                                       context="{'tree_view_ref': 'dnu_meeting_asset.view_dnu_asset_tree_selection'}">
                                    <tree>
                                        <field name="name"/>
                                        <field name="category_id"/>
                                        <field name="state"/>
                                    </tree>
                                </field>
                            </group>
                        </group>
                        <notebook>
                            <page string="M√¥ t·∫£">
                                <field name="description" placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ cu·ªôc h·ªçp..."/>
                            </page>
                            <page string="Zoom Meeting" attrs="{'invisible': [('meeting_type', '!=', 'online')]}">
                                <div class="alert alert-info" role="alert" attrs="{'invisible': [('zoom_meeting_id', '!=', False)]}">
                                    <i class="fa fa-info-circle"/> Zoom meeting s·∫Ω ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông khi x√°c nh·∫≠n ƒë·∫∑t ph√≤ng.
                                </div>
                                <group attrs="{'invisible': [('zoom_meeting_id', '=', False)]}">
                                    <group>
                                        <field name="zoom_password" readonly="1"/>
                                        <field name="zoom_sync_status" readonly="1"/>
                                    </group>
                                    <group>
                                        <field name="zoom_join_url" widget="url" readonly="1"/>
                                        <field name="zoom_start_url" widget="url" readonly="1"/>
                                    </group>
                                </group>
                                <div attrs="{'invisible': [('zoom_meeting_id', '=', False)]}">
                                    <button name="action_open_zoom_meeting" string="üîó M·ªü link Zoom" type="object" class="btn-primary"/>
                                </div>
                                <div attrs="{'invisible': ['|', ('zoom_meeting_id', '!=', False), ('state', '!=', 'confirmed')]}">
                                    <button name="action_create_zoom_meeting" string="‚ûï T·∫°o Zoom Meeting" type="object" class="btn-success"/>
                                </div>
                            </page>
                            <page string="Google Calendar">
                                <div class="alert alert-info" role="alert" attrs="{'invisible': [('google_calendar_event_id', '!=', False)]}">
                                    <i class="fa fa-info-circle"/> S·ª± ki·ªán s·∫Ω ƒë∆∞·ª£c t·ª± ƒë·ªông ƒë·ªìng b·ªô l√™n Google Calendar khi x√°c nh·∫≠n.
                                </div>
                                <group attrs="{'invisible': [('google_calendar_event_id', '=', False)]}">
                                    <field name="google_calendar_link" widget="url" readonly="1"/>
                                    <field name="google_sync_status" readonly="1"/>
                                </group>
                                <div>
                                    <button name="action_open_google_calendar" string="üìÖ M·ªü Google Calendar" type="object" class="btn-primary mr-2" attrs="{'invisible': [('google_calendar_event_id', '=', False)]}"/>
                                    <button name="action_sync_google_calendar" string="üîÑ ƒê·ªìng b·ªô Google Calendar" type="object" class="btn-info" attrs="{'invisible': [('state', 'not in', ['confirmed', 'in_progress'])]}"/>
                                </div>
                            </page>
                            <page string="Check-in/out" attrs="{'invisible': [('state', 'in', ['draft', 'submitted', 'cancelled'])]}">
                                <group>
                                    <group>
                                        <field name="checkin_datetime" readonly="1"/>
                                        <field name="checkin_by" readonly="1"/>
                                    </group>
                                    <group>
                                        <field name="checkout_datetime" readonly="1"/>
                                    </group>
                                </group>
                            </page>
                            <page string="L·ªãch s·ª± ki·ªán" attrs="{'invisible': [('calendar_event_id', '=', False)]}">
                                <group>
                                    <field name="calendar_event_id" readonly="1"/>
                                </group>
                            </page>
                            <page string="Ghi ch√∫">
                                <field name="notes" placeholder="Ghi ch√∫ kh√°c..."/>
                            </page>
                        </notebook>
                        <group string="L√Ω do h·ªßy" attrs="{'invisible': [('state', '!=', 'cancelled')]}">
                            <field name="cancellation_reason" nolabel="1"/>
                        </group>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>

        <!-- Search View -->
        <record id="view_dnu_meeting_booking_search" model="ir.ui.view">
            <field name="name">dnu.meeting.booking.search</field>
            <field name="model">dnu.meeting.booking</field>
            <field name="arch" type="xml">
                <search string="ƒê·∫∑t ph√≤ng">
                    <field name="name"/>
                    <field name="subject"/>
                    <field name="room_id"/>
                    <field name="organizer_id"/>
                    <separator/>
                    <filter string="Nh√°p" name="draft" domain="[('state', '=', 'draft')]"/>
                    <filter string="Ch·ªù duy·ªát" name="submitted" domain="[('state', '=', 'submitted')]"/>
                    <filter string="ƒê√£ x√°c nh·∫≠n" name="confirmed" domain="[('state', '=', 'confirmed')]"/>
                    <filter string="ƒêang di·ªÖn ra" name="in_progress" domain="[('state', '=', 'in_progress')]"/>
                    <filter string="Ho√†n th√†nh" name="done" domain="[('state', '=', 'done')]"/>
                    <separator/>
                    <filter string="H·ªçp tr·ª±c tuy·∫øn (Zoom)" name="online" domain="[('meeting_type', '=', 'online')]"/>
                    <filter string="H·ªçp tr·ª±c ti·∫øp" name="offline" domain="[('meeting_type', '=', 'offline')]"/>
                    <separator/>
                    <filter string="T·∫•t c·∫£ booking" name="all_bookings" domain="[('state', 'in', ['draft', 'submitted', 'confirmed', 'in_progress'])]"/>
                    <filter string="C·ªßa t√¥i" name="my_bookings" domain="[('organizer_id.user_id', '=', uid)]"/>
                    <filter string="H√¥m nay" name="today" domain="[('start_datetime', '&gt;=', datetime.datetime.combine(context_today(), datetime.time(0,0,0))), ('start_datetime', '&lt;=', datetime.datetime.combine(context_today(), datetime.time(23,59,59)))]"/>
                    <filter string="Tu·∫ßn n√†y" name="this_week" domain="[('start_datetime', '&gt;=', (context_today() - datetime.timedelta(days=context_today().weekday())).strftime('%Y-%m-%d')), ('start_datetime', '&lt;', (context_today() + datetime.timedelta(days=7-context_today().weekday())).strftime('%Y-%m-%d'))]"/>
                    <filter string="Th√°ng n√†y" name="this_month" domain="[('start_datetime', '&gt;=', (context_today().replace(day=1)).strftime('%Y-%m-%d')), ('start_datetime', '&lt;', ((context_today().replace(day=1) + datetime.timedelta(days=32)).replace(day=1)).strftime('%Y-%m-%d'))]"/>
                    <separator/>
                    <group expand="0" string="Group By">
                        <filter string="Ph√≤ng h·ªçp" name="group_room" context="{'group_by': 'room_id'}"/>
                        <filter string="Ng∆∞·ªùi t·ªï ch·ª©c" name="group_organizer" context="{'group_by': 'organizer_id'}"/>
                        <filter string="Tr·∫°ng th√°i" name="group_state" context="{'group_by': 'state'}"/>
                        <filter string="Ng√†y b·∫Øt ƒë·∫ßu" name="group_start_date" context="{'group_by': 'start_datetime:day'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Action -->
        <record id="action_dnu_meeting_booking" model="ir.actions.act_window">
            <field name="name">ƒê·∫∑t ph√≤ng h·ªçp</field>
            <field name="res_model">dnu.meeting.booking</field>
            <field name="view_mode">calendar,tree,form</field>
            <field name="search_view_id" ref="view_dnu_meeting_booking_search"/>
            <field name="context">{'search_default_confirmed': 1, 'search_default_in_progress': 1, 'auto_submit_on_create': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    ƒê·∫∑t ph√≤ng h·ªçp m·ªõi
                </p>
                <p>
                    ƒê·∫∑t ph√≤ng h·ªçp cho cu·ªôc h·ªçp c·ªßa b·∫°n. H·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông ki·ªÉm tra xung ƒë·ªôt.
                </p>
            </field>
        </record>

        <!-- Action for Approval Page -->
        <record id="action_dnu_meeting_booking_approval" model="ir.actions.act_window">
            <field name="name">Duy·ªát ƒë·∫∑t ph√≤ng</field>
            <field name="res_model">dnu.meeting.booking</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="view_dnu_meeting_booking_search"/>
            <field name="domain">[('state', '=', 'submitted')]</field>
            <field name="context">{'default_state': 'submitted'}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Kh√¥ng c√≥ y√™u c·∫ßu ƒë·∫∑t ph√≤ng ch·ªù duy·ªát
                </p>
                <p>
                    C√°c y√™u c·∫ßu ƒë·∫∑t ph√≤ng ch·ªù duy·ªát s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y.
                </p>
            </field>
        </record>

        <!-- Action: L·ªãch s·ª≠ ƒë·∫∑t ph√≤ng - H√¥m nay -->
        <record id="action_booking_history_today" model="ir.actions.act_window">
            <field name="name">ƒê·∫∑t ph√≤ng H√¥m nay</field>
            <field name="res_model">dnu.meeting.booking</field>
            <field name="view_mode">tree,form,calendar</field>
            <field name="search_view_id" ref="view_dnu_meeting_booking_search"/>
            <field name="context">{'search_default_today': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Kh√¥ng c√≥ l·ªãch ƒë·∫∑t ph√≤ng h√¥m nay
                </p>
            </field>
        </record>

        <!-- Action: L·ªãch s·ª≠ ƒë·∫∑t ph√≤ng - Tu·∫ßn n√†y -->
        <record id="action_booking_history_week" model="ir.actions.act_window">
            <field name="name">ƒê·∫∑t ph√≤ng Tu·∫ßn n√†y</field>
            <field name="res_model">dnu.meeting.booking</field>
            <field name="view_mode">tree,form,calendar</field>
            <field name="search_view_id" ref="view_dnu_meeting_booking_search"/>
            <field name="context">{'search_default_this_week': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Kh√¥ng c√≥ l·ªãch ƒë·∫∑t ph√≤ng tu·∫ßn n√†y
                </p>
            </field>
        </record>

        <!-- Action: L·ªãch s·ª≠ ƒë·∫∑t ph√≤ng - Th√°ng n√†y -->
        <record id="action_booking_history_month" model="ir.actions.act_window">
            <field name="name">ƒê·∫∑t ph√≤ng Th√°ng n√†y</field>
            <field name="res_model">dnu.meeting.booking</field>
            <field name="view_mode">tree,form,calendar</field>
            <field name="search_view_id" ref="view_dnu_meeting_booking_search"/>
            <field name="context">{'search_default_this_month': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Kh√¥ng c√≥ l·ªãch ƒë·∫∑t ph√≤ng th√°ng n√†y
                </p>
            </field>
        </record>

        <!-- Action: T·∫•t c·∫£ l·ªãch s·ª≠ ƒë·∫∑t ph√≤ng -->
        <record id="action_booking_history_all" model="ir.actions.act_window">
            <field name="name">L·ªãch s·ª≠ ƒê·∫∑t ph√≤ng</field>
            <field name="res_model">dnu.meeting.booking</field>
            <field name="view_mode">tree,form,calendar</field>
            <field name="search_view_id" ref="view_dnu_meeting_booking_search"/>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Ch∆∞a c√≥ l·ªãch s·ª≠ ƒë·∫∑t ph√≤ng
                </p>
            </field>
        </record>

    </data>
</odoo>
